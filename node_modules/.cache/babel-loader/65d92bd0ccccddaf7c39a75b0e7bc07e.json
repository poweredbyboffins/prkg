{"ast":null,"code":"var _jsxFileName = \"/home/andy/rr/consuming-rest/src/piechart.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport './pc.css';\nimport $ from 'jquery'; //import * as js from './jsondata.json'\n//import * as jsondata from './jsondata'\n\nvar jsondata = require('/home/andy/rr/consuming-rest/src/jsondata.json');\n\nclass piechart extends React.Component {\n  constructor(props) {\n    super(props); //this.createGraph = this.createGraph(this);\n\n    this.myRef = React.createRef();\n  } //    static propTypes = {...}\n\n\n  componentDidMount() {\n    this.d3pieChart();\n  }\n\n  componentDidUpdate() {//this.createGraph(this.myRef)\n  }\n\n  componentWillMount() {//this.createGraph(this.myRef)\n  }\n\n  d3pieChart() {\n    var nb_sliders = null; // nb of range sliders\n\n    var moving_id = null; // id of the moved slider\n\n    var oldValue = []; // previous values of the sliders\n    // pie chart radius\n\n    var radius = 100; // setup the margins so we don't clip the outter labels\n\n    var margin = {\n      top: 100,\n      right: 100,\n      bottom: 100,\n      left: 175\n    };\n    var canvasWidth = radius * 2 + margin.left + margin.right,\n        canvasHeight = radius * 2 + margin.top + margin.bottom; // color scheme (10, 20, 20b, 20c ...)\n    //var color = d3.scale.ordinal()\n    //  .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n    //var color = d3.scale.category10(); \n\n    var color = d3.scaleOrdinal(d3.schemeCategory10); // center legend\n\n    var legendData = [{\n      label: \"Sample\",\n      value: 300\n    }, {\n      label: \"Total People\",\n      value: 7200000\n    }];\n    var pi = Math.PI; // 3.14\n    // pie chart config\n\n    var pie = d3.pie().value(function (d) {\n      return d.value;\n    }) //.startAngle(-90 * (pi/180))\n    // .endAngle(90 * (pi/180))\n    .sort(null); // arc object\n\n    var arc = d3.arc().outerRadius(radius).innerRadius(radius / 3); // My slider\n\n    var range = $('.input-range'),\n        value = $('.range-value');\n    value.html(range.attr('value'));\n    /*\n    var range = 10\n    var value = 10\n    var i = 0\n    */\n\n    range.on('input', function () {\n      value.html(this.value);\n      showHelp();\n    }); // segement number sliders event\n\n    d3.selectAll('.input-range').on('input', function () {\n      nb_sliders = $(this).val();\n      init();\n    }); // initialize the sliders, events and pie chart\n\n    function init() {\n      oldValue = [];\n      moving_id = null;\n      d3.select('#rangebox tbody').html(''); // append sliders to table\n\n      var i = 0;\n\n      for (i = 0; i < nb_sliders; i++) {\n        var tr = d3.select('#rangebox tbody').append('tr');\n        tr.append('td').attr('class', 'edit').attr('bgcolor', function (d, i) {\n          return color(i);\n        }).attr('contenteditable', true).text('' + (i + 1));\n        tr.append('td').append('input').attr('type', 'range').attr('data-id', i).attr('class', 'range').attr('step', 1).attr('min', 0).attr('max', 100);\n        tr.append('td').attr('class', 'range_value');\n      }\n\n      d3.selectAll('#rangebox .range').each(function () {\n        var def = parseInt(100 / nb_sliders);\n        this.value = def;\n        oldValue[d3.select(this).attr('data-id')] = this.value;\n      });\n      equalize();\n      showValues();\n      pieChart();\n      seteditboxcolor(); // content edit event\n\n      d3.selectAll('.edit').on('input', function () {\n        updateLabels();\n      }); // slider event\n\n      d3.selectAll('.range').on('input', function () {\n        this.value = parseInt(this.value);\n        if (this.value < 0) this.value = 0;else if (this.value > 100) this.value = 100;\n        var id = d3.select(this).attr('data-id');\n        moving_id = id;\n        var old_value = oldValue[moving_id];\n        var new_value = this.value;\n        var delta = (new_value - old_value) / (nb_sliders - 1);\n        d3.selectAll('#rangebox .range').each(function () {\n          var r_id = d3.select(this).attr('data-id');\n          var r_val = this.value;\n\n          if (r_id != moving_id && r_val > delta) {\n            var equalized = parseInt(r_val - delta);\n            this.value = equalized;\n            oldValue[r_id] = this.value;\n          }\n        });\n        oldValue[moving_id] = new_value;\n        equalize();\n        showValues();\n        updatePieChart();\n      });\n    } // set edit box color to match slice color\n\n\n    function showHelp() {\n      // use jQuery to target h5 edit boxes)\n      $(document).ready(function () {\n        $('h5').css({\n          \"opacity\": \".4\"\n        });\n        $('#pieImage').css({\n          \"display\": \"none\"\n        });\n      });\n    } // set edit box color to match slice color\n\n\n    function seteditboxcolor() {\n      // var slicepaths= d3.selectAll('.slice')\n      var mycolors = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n      var editboxes = d3.selectAll('.edit').data(mycolors).attr('bgcolor', function (d) {\n        return color(d);\n      });\n    } // get JSON data from sliders\n\n\n    function getData() {\n      var json = [];\n      d3.selectAll('#rangebox .range').each(function () {\n        json.push({\n          label: d3.select(this.parentNode.parentNode).select('td:first-child').text(),\n          value: this.value\n        });\n      });\n      return json;\n    } // compute total percentage from sliders\n\n\n    function getTotal() {\n      var total = 0;\n      d3.selectAll('#rangebox .range').each(function () {\n        total = total + parseInt(this.value);\n      });\n      return total;\n    } // equalize the sliders (decimal delta)\n\n\n    function equalize() {\n      var remaining = 100 - getTotal();\n\n      if (remaining != 0) {\n        var to_eq = null;\n        var min = null;\n        var max = null;\n        var min_value = 9999;\n        var max_value = 0;\n        console.log(remaining);\n        d3.selectAll('#rangebox .range').each(function () {\n          var id = d3.select(this).attr('data-id');\n\n          if (id != moving_id) {\n            if (parseInt(this.value) > parseInt(max_value)) {\n              max_value = this.value;\n              max = this;\n            }\n\n            if (parseInt(this.value) < parseInt(min_value)) {\n              min_value = this.value;\n              min = this;\n            }\n          }\n        });\n        if (remaining > 0) to_eq = min;else to_eq = max;\n\n        if (to_eq) {\n          if (remaining > 0) {\n            to_eq.value = parseInt(to_eq.value) + 1;\n            remaining = remaining - 1;\n          } else {\n            to_eq.value = parseInt(to_eq.value) - 1;\n            remaining = remaining + 1;\n          }\n\n          oldValue[d3.select(to_eq).attr('data-id')] = to_eq.value;\n          if (remaining != 0) equalize();\n        }\n      }\n    } // show slider value\n\n\n    function showValues() {\n      d3.selectAll('#rangebox .range').each(function () {\n        var perct = this.value + '%';\n        d3.select(this.parentNode.nextSibling).html(perct);\n      });\n    } // draw pie chart\n\n\n    function pieChart() {\n      var json = getData();\n      var canvaCenterX = (radius * 2 + margin.left + margin.right) / 2;\n      var canvaCenterY = (radius * 2 + margin.top + margin.bottom) / 2;\n      d3.select(\"#pie svg\").remove(); // svg canvas\n\n      var svg = d3.select(\"#pie\").append(\"svg:svg\").attr(\"width\", canvasWidth).attr(\"height\", canvasHeight).append(\"svg:g\").attr(\"transform\", \"translate(\" + canvasWidth / 2 + \",\" + canvasHeight / 2 + \")\"); // create the classes under the transform\n\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"slices\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"labels\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"lines\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"legend\"); // group all ther paths into the slices class\n\n      var arcpaths = svg.select(\".slices\").selectAll(\"path\").data(pie(getData())); // render the slices\n\n      arcpaths.enter().append('svg:path').attr(\"class\", \"slice\").attr(\"fill\", function (d, i) {\n        return color(i);\n      }).attr(\"d\", arc).each(function (d) {\n        this._current = d;\n      }).append('title').text(function (d, i) {\n        return json[i].value + '%';\n      }); // group all ther paths into the slices class\n\n      var arclabels = svg.select(\".labels\").selectAll(\"label\").data(pie(getData())); // render the labels\n\n      arclabels.enter().append(\"svg:text\").attr(\"class\", \"label\").attr(\"transform\", function (d) {\n        return \"translate(\" + arc.centroid(d) + \")\";\n      }).attr(\"text-anchor\", \"middle\").text(function (d, i) {\n        if (json[i].value > 1) return json[i].label;else return null;\n      });\n    } // update pie chart\n\n\n    function updatePieChart() {\n      updateArcs();\n      updateLabels();\n      updateLabelLines();\n    } // update the slices of the pie chart\n\n\n    function updateArcs() {\n      var json = getData();\n      d3.selectAll(\"#pie path title\").text(function (d, i) {\n        return json[i].value + '%';\n      });\n      d3.selectAll(\"#pie path\").data(pie(json)).transition().duration(100).attrTween('d', arcTween);\n    }\n    /* ------- TEXT LABELS -------*/\n    // update the labels of the pie chart\n\n\n    function updateLabels() {\n      var labelr = radius + 40; // radius for label anchor\n\n      d3.selectAll(\"#pie text\").data(pie(getData())).transition().duration(120).attr(\"transform\", function (d) {\n        var c = arc.centroid(d),\n            x = c[0],\n            y = c[1],\n            // pythagorean theorem for hypotenuse\n        h = Math.sqrt(x * x + y * y);\n        return \"translate(\" + x / h * labelr + ',' + y / h * labelr + \")\";\n      }).attr(\"dy\", \".35em\").attr(\"text-anchor\", function (d) {\n        // are we past the center?\n        return (d.endAngle + d.startAngle) / 2 > Math.PI ? \"end\" : \"start\";\n      }) //.text(function(d, i) { return d.value.toFixed(2); });\n      .text(function (d, i) {\n        if (getData()[i].value > 0) return getData()[i].label;else return null;\n      });\n    }\n    /* ------- SLICE TO TEXT POLYLINES -------*/\n\n\n    var outerArc = d3.arc().innerRadius(radius + 50).outerRadius(radius * .95);\n\n    function midAngle(d) {\n      return d.startAngle + (d.endAngle - d.startAngle) / 2;\n    }\n\n    function updateLabelLines() {\n      var polyline = d3.select(\".lines\").selectAll(\"polyline\").data(pie(getData())); //alert(\"I am an alert box!\");\n\n      polyline.enter().append(\"polyline\");\n      polyline.transition().duration(100).attrTween(\"points\", function (d) {\n        this._current = this._current || d;\n        var interpolate = d3.interpolate(this._current, d);\n        this._current = interpolate(0);\n        return function (t) {\n          var d2 = interpolate(t);\n          var pos = 0; // outerArc.centroid(d2);\n          // pos[0] = radius * .95 * (midAngle(d2) < Math.PI ? 1 : -1);\n\n          return [arc.centroid(d2), outerArc.centroid(d2)];\n        };\n      });\n      polyline.exit().remove();\n    } // transition for the arcs\n\n\n    function arcTween(a) {\n      var i = d3.interpolate(this._current, a);\n      this._current = i(0);\n      return function (t) {\n        return arc(i(t));\n      };\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"main-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"chart-controls\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      id: \"nbForm\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 465\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      id: \"menu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 466\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469\n      },\n      __self: this\n    }, \"Select Number of Chart Segments\")), React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 470\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      class: \"range-slider\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      id: \"nbSliders\",\n      class: \"input-range\",\n      type: \"range\",\n      value: \"1\",\n      min: \"1\",\n      max: \"10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      class: \"range-value\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474\n      },\n      __self: this\n    })), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 476\n      },\n      __self: this\n    })))), React.createElement(\"table\", {\n      id: \"rangebox\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484\n      },\n      __self: this\n    }, React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      class: \"HideOnLoad\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487\n      },\n      __self: this\n    }, \"Click boxes to edit labels\")))), React.createElement(\"div\", {\n      id: \"pieImage\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"pie\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default piechart;","map":{"version":3,"sources":["/home/andy/rr/consuming-rest/src/piechart.js"],"names":["React","Component","d3","$","jsondata","require","piechart","constructor","props","myRef","createRef","componentDidMount","d3pieChart","componentDidUpdate","componentWillMount","nb_sliders","moving_id","oldValue","radius","margin","top","right","bottom","left","canvasWidth","canvasHeight","color","scaleOrdinal","schemeCategory10","legendData","label","value","pi","Math","PI","pie","d","sort","arc","outerRadius","innerRadius","range","html","attr","on","showHelp","selectAll","val","init","select","i","tr","append","text","each","def","parseInt","equalize","showValues","pieChart","seteditboxcolor","updateLabels","id","old_value","new_value","delta","r_id","r_val","equalized","updatePieChart","document","ready","css","mycolors","editboxes","data","getData","json","push","parentNode","getTotal","total","remaining","to_eq","min","max","min_value","max_value","console","log","perct","nextSibling","canvaCenterX","canvaCenterY","remove","svg","arcpaths","enter","_current","arclabels","centroid","updateArcs","updateLabelLines","transition","duration","attrTween","arcTween","labelr","c","x","y","h","sqrt","endAngle","startAngle","outerArc","midAngle","polyline","interpolate","t","d2","pos","exit","a","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAO,UAAP;AACA,OAAOC,CAAP,MAAc,QAAd,C,CACA;AACA;;AACA,IAAIC,QAAQ,GAACC,OAAO,CAAC,gDAAD,CAApB;;AAEA,MAAMC,QAAN,SAAuBN,KAAK,CAACC,SAA7B,CAAuC;AACvCM,EAAAA,WAAW,CAACC,KAAD,EAAO;AACZ,UAAMA,KAAN,EADY,CAEZ;;AACA,SAAKC,KAAL,GAAaT,KAAK,CAACU,SAAN,EAAb;AACF,GALmC,CAOvC;;;AAEIC,EAAAA,iBAAiB,GAAG;AACjB,SAAKC,UAAL;AACF;;AACDC,EAAAA,kBAAkB,GAAG,CAClB;AACF;;AACDC,EAAAA,kBAAkB,GAAG,CAClB;AACF;;AAGLF,EAAAA,UAAU,GACV;AAEA,QAAIG,UAAU,GAAG,IAAjB,CAFA,CAEuB;;AACvB,QAAIC,SAAS,GAAG,IAAhB,CAHA,CAGsB;;AACtB,QAAIC,QAAQ,GAAG,EAAf,CAJA,CAImB;AAEnB;;AACA,QAAIC,MAAM,GAAG,GAAb,CAPA,CASA;;AACA,QAAIC,MAAM,GAAG;AACXC,MAAAA,GAAG,EAAE,GADM;AAEXC,MAAAA,KAAK,EAAE,GAFI;AAGXC,MAAAA,MAAM,EAAE,GAHG;AAIXC,MAAAA,IAAI,EAAE;AAJK,KAAb;AAMA,QAAIC,WAAW,GAAGN,MAAM,GAAG,CAAT,GAAaC,MAAM,CAACI,IAApB,GAA2BJ,MAAM,CAACE,KAApD;AAAA,QACEI,YAAY,GAAGP,MAAM,GAAG,CAAT,GAAaC,MAAM,CAACC,GAApB,GAA0BD,MAAM,CAACG,MADlD,CAhBA,CAmBA;AACA;AACA;AAEA;;AACA,QAAII,KAAK,GAAGxB,EAAE,CAACyB,YAAH,CAAgBzB,EAAE,CAAC0B,gBAAnB,CAAZ,CAxBA,CA0BA;;AACA,QAAIC,UAAU,GAAG,CAAC;AAChBC,MAAAA,KAAK,EAAE,QADS;AAEhBC,MAAAA,KAAK,EAAE;AAFS,KAAD,EAGd;AACDD,MAAAA,KAAK,EAAE,cADN;AAEDC,MAAAA,KAAK,EAAE;AAFN,KAHc,CAAjB;AAQA,QAAIC,EAAE,GAAGC,IAAI,CAACC,EAAd,CAnCA,CAmCkB;AAElB;;AACA,QAAIC,GAAG,GAAGjC,EAAE,CAACiC,GAAH,GACPJ,KADO,CACD,UAASK,CAAT,EAAY;AACjB,aAAOA,CAAC,CAACL,KAAT;AACD,KAHO,EAIR;AACA;AALQ,KAMPM,IANO,CAMF,IANE,CAAV,CAtCA,CA8CA;;AACA,QAAIC,GAAG,GAAGpC,EAAE,CAACoC,GAAH,GACPC,WADO,CACKrB,MADL,EAEPsB,WAFO,CAEKtB,MAAM,GAAG,CAFd,CAAV,CA/CA,CAmDA;;AAEA,QAAIuB,KAAK,GAAGtC,CAAC,CAAC,cAAD,CAAb;AAAA,QACE4B,KAAK,GAAG5B,CAAC,CAAC,cAAD,CADX;AAEA4B,IAAAA,KAAK,CAACW,IAAN,CAAWD,KAAK,CAACE,IAAN,CAAW,OAAX,CAAX;AACA;;;;;;AAKAF,IAAAA,KAAK,CAACG,EAAN,CAAS,OAAT,EAAkB,YAAW;AAC3Bb,MAAAA,KAAK,CAACW,IAAN,CAAW,KAAKX,KAAhB;AACGc,MAAAA,QAAQ;AACZ,KAHD,EA7DA,CAkEA;;AACA3C,IAAAA,EAAE,CAAC4C,SAAH,CAAa,cAAb,EAA6BF,EAA7B,CAAgC,OAAhC,EAAyC,YAAW;AAClD7B,MAAAA,UAAU,GAAGZ,CAAC,CAAC,IAAD,CAAD,CAAQ4C,GAAR,EAAb;AACAC,MAAAA,IAAI;AAEL,KAJD,EAnEA,CA0EA;;AACA,aAASA,IAAT,GAAgB;AACd/B,MAAAA,QAAQ,GAAG,EAAX;AACAD,MAAAA,SAAS,GAAG,IAAZ;AAGAd,MAAAA,EAAE,CAAC+C,MAAH,CAAU,iBAAV,EAA6BP,IAA7B,CAAkC,EAAlC,EALc,CAOd;;AACA,UAAIQ,CAAC,GAAC,CAAN;;AACA,WAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnC,UAAhB,EAA4BmC,CAAC,EAA7B,EAAiC;AAC/B,YAAIC,EAAE,GAAGjD,EAAE,CAAC+C,MAAH,CAAU,iBAAV,EAA6BG,MAA7B,CAAoC,IAApC,CAAT;AACAD,QAAAA,EAAE,CAACC,MAAH,CAAU,IAAV,EACGT,IADH,CACQ,OADR,EACiB,MADjB,EAEGA,IAFH,CAEQ,SAFR,EAEmB,UAASP,CAAT,EAAYc,CAAZ,EAAc;AAAC,iBAAOxB,KAAK,CAACwB,CAAD,CAAZ;AAAgB,SAFlD,EAGGP,IAHH,CAGQ,iBAHR,EAG2B,IAH3B,EAIGU,IAJH,CAIQ,MAAMH,CAAC,GAAG,CAAV,CAJR;AAOAC,QAAAA,EAAE,CAACC,MAAH,CAAU,IAAV,EACGA,MADH,CACU,OADV,EAEGT,IAFH,CAEQ,MAFR,EAEgB,OAFhB,EAGGA,IAHH,CAGQ,SAHR,EAGmBO,CAHnB,EAIGP,IAJH,CAIQ,OAJR,EAIiB,OAJjB,EAKGA,IALH,CAKQ,MALR,EAKgB,CALhB,EAMGA,IANH,CAMQ,KANR,EAMe,CANf,EAOGA,IAPH,CAOQ,KAPR,EAOe,GAPf;AAQAQ,QAAAA,EAAE,CAACC,MAAH,CAAU,IAAV,EACGT,IADH,CACQ,OADR,EACiB,aADjB;AAED;;AAEDzC,MAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAC/C,YAAIC,GAAG,GAAGC,QAAQ,CAAC,MAAMzC,UAAP,CAAlB;AACA,aAAKgB,KAAL,GAAawB,GAAb;AACAtC,QAAAA,QAAQ,CAACf,EAAE,CAAC+C,MAAH,CAAU,IAAV,EAAgBN,IAAhB,CAAqB,SAArB,CAAD,CAAR,GAA4C,KAAKZ,KAAjD;AACD,OAJD;AAMA0B,MAAAA,QAAQ;AACRC,MAAAA,UAAU;AACVC,MAAAA,QAAQ;AACRC,MAAAA,eAAe,GAvCD,CAyCd;;AACA1D,MAAAA,EAAE,CAAC4C,SAAH,CAAa,OAAb,EAAsBF,EAAtB,CAAyB,OAAzB,EAAkC,YAAW;AAC3CiB,QAAAA,YAAY;AACb,OAFD,EA1Cc,CA8Cd;;AACA3D,MAAAA,EAAE,CAAC4C,SAAH,CAAa,QAAb,EAAuBF,EAAvB,CAA0B,OAA1B,EAAmC,YAAW;AAC5C,aAAKb,KAAL,GAAayB,QAAQ,CAAC,KAAKzB,KAAN,CAArB;AACA,YAAI,KAAKA,KAAL,GAAa,CAAjB,EAAoB,KAAKA,KAAL,GAAa,CAAb,CAApB,KACK,IAAI,KAAKA,KAAL,GAAa,GAAjB,EAAsB,KAAKA,KAAL,GAAa,GAAb;AAE3B,YAAI+B,EAAE,GAAG5D,EAAE,CAAC+C,MAAH,CAAU,IAAV,EAAgBN,IAAhB,CAAqB,SAArB,CAAT;AACA3B,QAAAA,SAAS,GAAG8C,EAAZ;AAEA,YAAIC,SAAS,GAAG9C,QAAQ,CAACD,SAAD,CAAxB;AACA,YAAIgD,SAAS,GAAG,KAAKjC,KAArB;AACA,YAAIkC,KAAK,GAAG,CAACD,SAAS,GAAGD,SAAb,KAA2BhD,UAAU,GAAG,CAAxC,CAAZ;AAEAb,QAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAC/C,cAAIY,IAAI,GAAGhE,EAAE,CAAC+C,MAAH,CAAU,IAAV,EAAgBN,IAAhB,CAAqB,SAArB,CAAX;AACA,cAAIwB,KAAK,GAAG,KAAKpC,KAAjB;;AACA,cAAImC,IAAI,IAAIlD,SAAR,IAAqBmD,KAAK,GAAGF,KAAjC,EAAwC;AACtC,gBAAIG,SAAS,GAAGZ,QAAQ,CAACW,KAAK,GAAGF,KAAT,CAAxB;AACA,iBAAKlC,KAAL,GAAaqC,SAAb;AACAnD,YAAAA,QAAQ,CAACiD,IAAD,CAAR,GAAiB,KAAKnC,KAAtB;AACD;AACF,SARD;AAUAd,QAAAA,QAAQ,CAACD,SAAD,CAAR,GAAsBgD,SAAtB;AAEAP,QAAAA,QAAQ;AACRC,QAAAA,UAAU;AACVW,QAAAA,cAAc;AAEf,OA5BD;AA6BD,KAvJD,CAyJA;;;AACA,aAASxB,QAAT,GAAoB;AAClB;AACA1C,MAAAA,CAAC,CAACmE,QAAD,CAAD,CAAYC,KAAZ,CAAkB,YAAU;AAC1BpE,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQqE,GAAR,CAAY;AAAC,qBAAU;AAAX,SAAZ;AACArE,QAAAA,CAAC,CAAC,WAAD,CAAD,CAAeqE,GAAf,CAAmB;AAAC,qBAAU;AAAX,SAAnB;AAAwC,OAF1C;AAGD,KA/JD,CAiKA;;;AACA,aAASZ,eAAT,GAA2B;AACzB;AACG,UAAIa,QAAQ,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAAf;AACA,UAAIC,SAAS,GAAGxE,EAAE,CAAC4C,SAAH,CAAa,OAAb,EACG6B,IADH,CACQF,QADR,EAEG9B,IAFH,CAEQ,SAFR,EAEmB,UAASP,CAAT,EAAW;AAAE,eAAOV,KAAK,CAACU,CAAD,CAAZ;AAAkB,OAFlD,CAAhB;AAGH,KAxKF,CA2KA;;;AACA,aAASwC,OAAT,GAAmB;AACjB,UAAIC,IAAI,GAAG,EAAX;AACA3E,MAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAE/CuB,QAAAA,IAAI,CAACC,IAAL,CAAU;AACRhD,UAAAA,KAAK,EAAE5B,EAAE,CAAC+C,MAAH,CAAU,KAAK8B,UAAL,CAAgBA,UAA1B,EACJ9B,MADI,CACG,gBADH,EAEJI,IAFI,EADC;AAIRtB,UAAAA,KAAK,EAAE,KAAKA;AAJJ,SAAV;AAMD,OARD;AASA,aAAO8C,IAAP;AACD,KAxLD,CA0LA;;;AACA,aAASG,QAAT,GAAoB;AAClB,UAAIC,KAAK,GAAG,CAAZ;AACA/E,MAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAC/C2B,QAAAA,KAAK,GAAGA,KAAK,GAAGzB,QAAQ,CAAC,KAAKzB,KAAN,CAAxB;AACD,OAFD;AAGA,aAAOkD,KAAP;AACD,KAjMD,CAmMA;;;AACA,aAASxB,QAAT,GAAoB;AAClB,UAAIyB,SAAS,GAAG,MAAMF,QAAQ,EAA9B;;AAEA,UAAIE,SAAS,IAAI,CAAjB,EAAoB;AAClB,YAAIC,KAAK,GAAG,IAAZ;AACA,YAAIC,GAAG,GAAG,IAAV;AACA,YAAIC,GAAG,GAAG,IAAV;AACA,YAAIC,SAAS,GAAG,IAAhB;AACA,YAAIC,SAAS,GAAG,CAAhB;AAEAC,QAAAA,OAAO,CAACC,GAAR,CAAYP,SAAZ;AAEAhF,QAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAC/C,cAAIQ,EAAE,GAAG5D,EAAE,CAAC+C,MAAH,CAAU,IAAV,EAAgBN,IAAhB,CAAqB,SAArB,CAAT;;AAEA,cAAImB,EAAE,IAAI9C,SAAV,EAAqB;AACnB,gBAAIwC,QAAQ,CAAC,KAAKzB,KAAN,CAAR,GAAuByB,QAAQ,CAAC+B,SAAD,CAAnC,EAAgD;AAC9CA,cAAAA,SAAS,GAAG,KAAKxD,KAAjB;AACAsD,cAAAA,GAAG,GAAG,IAAN;AACD;;AACD,gBAAI7B,QAAQ,CAAC,KAAKzB,KAAN,CAAR,GAAuByB,QAAQ,CAAC8B,SAAD,CAAnC,EAAgD;AAC9CA,cAAAA,SAAS,GAAG,KAAKvD,KAAjB;AACAqD,cAAAA,GAAG,GAAG,IAAN;AACD;AACF;AACF,SAbD;AAeA,YAAIF,SAAS,GAAG,CAAhB,EAAmBC,KAAK,GAAGC,GAAR,CAAnB,KACKD,KAAK,GAAGE,GAAR;;AAEL,YAAIF,KAAJ,EAAW;AACT,cAAID,SAAS,GAAG,CAAhB,EAAmB;AACjBC,YAAAA,KAAK,CAACpD,KAAN,GAAcyB,QAAQ,CAAC2B,KAAK,CAACpD,KAAP,CAAR,GAAwB,CAAtC;AACAmD,YAAAA,SAAS,GAAGA,SAAS,GAAG,CAAxB;AACD,WAHD,MAGO;AACLC,YAAAA,KAAK,CAACpD,KAAN,GAAcyB,QAAQ,CAAC2B,KAAK,CAACpD,KAAP,CAAR,GAAwB,CAAtC;AACAmD,YAAAA,SAAS,GAAGA,SAAS,GAAG,CAAxB;AACD;;AACDjE,UAAAA,QAAQ,CAACf,EAAE,CAAC+C,MAAH,CAAUkC,KAAV,EAAiBxC,IAAjB,CAAsB,SAAtB,CAAD,CAAR,GAA6CwC,KAAK,CAACpD,KAAnD;AAEA,cAAImD,SAAS,IAAI,CAAjB,EAAoBzB,QAAQ;AAC7B;AACF;AACF,KA/OD,CAiPA;;;AACA,aAASC,UAAT,GAAsB;AACpBxD,MAAAA,EAAE,CAAC4C,SAAH,CAAa,kBAAb,EAAiCQ,IAAjC,CAAsC,YAAW;AAC/C,YAAIoC,KAAK,GAAG,KAAK3D,KAAL,GAAa,GAAzB;AACA7B,QAAAA,EAAE,CAAC+C,MAAH,CAAU,KAAK8B,UAAL,CAAgBY,WAA1B,EAAuCjD,IAAvC,CAA4CgD,KAA5C;AACD,OAHD;AAID,KAvPD,CAyPA;;;AACA,aAAS/B,QAAT,GAAoB;AAGlB,UAAIkB,IAAI,GAAGD,OAAO,EAAlB;AACA,UAAIgB,YAAY,GAAG,CAAC1E,MAAM,GAAG,CAAT,GAAaC,MAAM,CAACI,IAApB,GAA2BJ,MAAM,CAACE,KAAnC,IAA4C,CAA/D;AACA,UAAIwE,YAAY,GAAG,CAAC3E,MAAM,GAAG,CAAT,GAAaC,MAAM,CAACC,GAApB,GAA0BD,MAAM,CAACG,MAAlC,IAA4C,CAA/D;AAEApB,MAAAA,EAAE,CAAC+C,MAAH,CAAU,UAAV,EAAsB6C,MAAtB,GAPkB,CASlB;;AACA,UAAIC,GAAG,GAAG7F,EAAE,CAAC+C,MAAH,CAAU,MAAV,EAETG,MAFS,CAEF,SAFE,EAGPT,IAHO,CAGF,OAHE,EAGOnB,WAHP,EAIPmB,IAJO,CAIF,QAJE,EAIQlB,YAJR,EAMT2B,MANS,CAMF,OANE,EAOPT,IAPO,CAOF,WAPE,EAOW,eAAenB,WAAW,GAAG,CAA7B,GAAiC,GAAjC,GAAuCC,YAAY,GAAG,CAAtD,GAA0D,GAPrE,CAAV,CAVkB,CAmBlB;;AACAvB,MAAAA,EAAE,CAAC+C,MAAH,CAAU,GAAV,EACGG,MADH,CACU,GADV,EAEGT,IAFH,CAEQ,OAFR,EAEiB,QAFjB;AAIAzC,MAAAA,EAAE,CAAC+C,MAAH,CAAU,GAAV,EACGG,MADH,CACU,GADV,EAEGT,IAFH,CAEQ,OAFR,EAEiB,QAFjB;AAIAzC,MAAAA,EAAE,CAAC+C,MAAH,CAAU,GAAV,EACGG,MADH,CACU,GADV,EAEGT,IAFH,CAEQ,OAFR,EAEiB,OAFjB;AAIAzC,MAAAA,EAAE,CAAC+C,MAAH,CAAU,GAAV,EACGG,MADH,CACU,GADV,EAEGT,IAFH,CAEQ,OAFR,EAEiB,QAFjB,EAhCkB,CAoClB;;AACA,UAAIqD,QAAQ,GAAGD,GAAG,CAAC9C,MAAJ,CAAW,SAAX,EAAsBH,SAAtB,CAAgC,MAAhC,EAAwC6B,IAAxC,CAA6CxC,GAAG,CAACyC,OAAO,EAAR,CAAhD,CAAf,CArCkB,CAuClB;;AACAoB,MAAAA,QAAQ,CAACC,KAAT,GAEC7C,MAFD,CAEQ,UAFR,EAGGT,IAHH,CAGQ,OAHR,EAGiB,OAHjB,EAIGA,IAJH,CAIQ,MAJR,EAIgB,UAASP,CAAT,EAAYc,CAAZ,EAAe;AAC3B,eAAOxB,KAAK,CAACwB,CAAD,CAAZ;AACD,OANH,EASKP,IATL,CASU,GATV,EASeL,GATf,EAUGgB,IAVH,CAUQ,UAASlB,CAAT,EAAY;AAChB,aAAK8D,QAAL,GAAgB9D,CAAhB;AACD,OAZH,EAaGgB,MAbH,CAaU,OAbV,EAcGC,IAdH,CAcQ,UAASjB,CAAT,EAAYc,CAAZ,EAAe;AACnB,eAAO2B,IAAI,CAAC3B,CAAD,CAAJ,CAAQnB,KAAR,GAAgB,GAAvB;AACD,OAhBH,EAxCkB,CA0DlB;;AACA,UAAIoE,SAAS,GAAGJ,GAAG,CAAC9C,MAAJ,CAAW,SAAX,EAAsBH,SAAtB,CAAgC,OAAhC,EAAyC6B,IAAzC,CAA8CxC,GAAG,CAACyC,OAAO,EAAR,CAAjD,CAAhB,CA3DkB,CA6DlB;;AACAuB,MAAAA,SAAS,CAACF,KAAV,GAEC7C,MAFD,CAEQ,UAFR,EAGGT,IAHH,CAGQ,OAHR,EAGiB,OAHjB,EAIGA,IAJH,CAIQ,WAJR,EAIqB,UAASP,CAAT,EAAY;AAC7B,eAAO,eAAeE,GAAG,CAAC8D,QAAJ,CAAahE,CAAb,CAAf,GAAiC,GAAxC;AACD,OANH,EAOGO,IAPH,CAOQ,aAPR,EAOuB,QAPvB,EAQGU,IARH,CAQQ,UAASjB,CAAT,EAAYc,CAAZ,EAAe;AACnB,YAAI2B,IAAI,CAAC3B,CAAD,CAAJ,CAAQnB,KAAR,GAAgB,CAApB,EAAuB,OAAO8C,IAAI,CAAC3B,CAAD,CAAJ,CAAQpB,KAAf,CAAvB,KACK,OAAO,IAAP;AACN,OAXH;AAYA,KApUF,CAsUA;;;AACA,aAASuC,cAAT,GAA0B;AACxBgC,MAAAA,UAAU;AACVxC,MAAAA,YAAY;AACZyC,MAAAA,gBAAgB;AAEjB,KA5UD,CA8UA;;;AACA,aAASD,UAAT,GAAsB;AACnB,UAAIxB,IAAI,GAAGD,OAAO,EAAlB;AAED1E,MAAAA,EAAE,CAAC4C,SAAH,CAAa,iBAAb,EACGO,IADH,CACQ,UAASjB,CAAT,EAAYc,CAAZ,EAAe;AACnB,eAAO2B,IAAI,CAAC3B,CAAD,CAAJ,CAAQnB,KAAR,GAAgB,GAAvB;AACD,OAHH;AAKA7B,MAAAA,EAAE,CAAC4C,SAAH,CAAa,WAAb,EACG6B,IADH,CACQxC,GAAG,CAAC0C,IAAD,CADX,EAEG0B,UAFH,GAGGC,QAHH,CAGY,GAHZ,EAIGC,SAJH,CAIa,GAJb,EAIkBC,QAJlB;AAKD;AAED;AACA;;;AACA,aAAS7C,YAAT,GAAwB;AACtB,UAAI8C,MAAM,GAAGzF,MAAM,GAAG,EAAtB,CADsB,CACG;;AACzBhB,MAAAA,EAAE,CAAC4C,SAAH,CAAa,WAAb,EACG6B,IADH,CACQxC,GAAG,CAACyC,OAAO,EAAR,CADX,EAEG2B,UAFH,GAGGC,QAHH,CAGY,GAHZ,EAKC7D,IALD,CAKM,WALN,EAKmB,UAASP,CAAT,EAAY;AAC3B,YAAIwE,CAAC,GAAGtE,GAAG,CAAC8D,QAAJ,CAAahE,CAAb,CAAR;AAAA,YACEyE,CAAC,GAAGD,CAAC,CAAC,CAAD,CADP;AAAA,YAEEE,CAAC,GAAGF,CAAC,CAAC,CAAD,CAFP;AAAA,YAGE;AACAG,QAAAA,CAAC,GAAG9E,IAAI,CAAC+E,IAAL,CAAUH,CAAC,GAAGA,CAAJ,GAAQC,CAAC,GAAGA,CAAtB,CAJN;AAKA,eAAO,eAAgBD,CAAC,GAAGE,CAAJ,GAAQJ,MAAxB,GAAkC,GAAlC,GACJG,CAAC,GAAGC,CAAJ,GAAQJ,MADJ,GACc,GADrB;AAED,OAbH,EAcGhE,IAdH,CAcQ,IAdR,EAcc,OAdd,EAeGA,IAfH,CAeQ,aAfR,EAeuB,UAASP,CAAT,EAAY;AAC/B;AACA,eAAO,CAACA,CAAC,CAAC6E,QAAF,GAAa7E,CAAC,CAAC8E,UAAhB,IAA8B,CAA9B,GAAkCjF,IAAI,CAACC,EAAvC,GACL,KADK,GACG,OADV;AAED,OAnBH,EAqBA;AArBA,OAsBCmB,IAtBD,CAsBM,UAASjB,CAAT,EAAYc,CAAZ,EAAe;AACnB,YAAI0B,OAAO,GAAG1B,CAAH,CAAP,CAAanB,KAAb,GAAqB,CAAzB,EAA4B,OAAO6C,OAAO,GAAG1B,CAAH,CAAP,CAAapB,KAApB,CAA5B,KACK,OAAO,IAAP;AACN,OAzBD;AA0BD;AAED;;;AAEA,QAAIqF,QAAQ,GAAEjH,EAAE,CAACoC,GAAH,GACXE,WADW,CACCtB,MAAM,GAAE,EADT,EAEXqB,WAFW,CAECrB,MAAM,GAAG,GAFV,CAAd;;AAIA,aAASkG,QAAT,CAAkBhF,CAAlB,EAAqB;AACnB,aAAOA,CAAC,CAAC8E,UAAF,GAAe,CAAC9E,CAAC,CAAC6E,QAAF,GAAa7E,CAAC,CAAC8E,UAAhB,IAA8B,CAApD;AACD;;AAED,aAASZ,gBAAT,GAA4B;AAC1B,UAAIe,QAAQ,GAAGnH,EAAE,CAAC+C,MAAH,CAAU,QAAV,EAAoBH,SAApB,CAA8B,UAA9B,EACZ6B,IADY,CACPxC,GAAG,CAACyC,OAAO,EAAR,CADI,CAAf,CAD0B,CAI1B;;AAEAyC,MAAAA,QAAQ,CAACpB,KAAT,GACG7C,MADH,CACU,UADV;AAGAiE,MAAAA,QAAQ,CAACd,UAAT,GACGC,QADH,CACY,GADZ,EAEGC,SAFH,CAEa,QAFb,EAEuB,UAASrE,CAAT,EAAY;AAC/B,aAAK8D,QAAL,GAAgB,KAAKA,QAAL,IAAiB9D,CAAjC;AACA,YAAIkF,WAAW,GAAGpH,EAAE,CAACoH,WAAH,CAAe,KAAKpB,QAApB,EAA8B9D,CAA9B,CAAlB;AACA,aAAK8D,QAAL,GAAgBoB,WAAW,CAAC,CAAD,CAA3B;AACA,eAAO,UAASC,CAAT,EAAY;AACjB,cAAIC,EAAE,GAAGF,WAAW,CAACC,CAAD,CAApB;AACA,cAAIE,GAAG,GAAG,CAAV,CAFiB,CAEJ;AACd;;AACA,iBAAO,CAACnF,GAAG,CAAC8D,QAAJ,CAAaoB,EAAb,CAAD,EAAmBL,QAAQ,CAACf,QAAT,CAAkBoB,EAAlB,CAAnB,CAAP;AACA,SALD;AAMD,OAZH;AAcAH,MAAAA,QAAQ,CAACK,IAAT,GACG5B,MADH;AAED,KAjaD,CAmaA;;;AACA,aAASY,QAAT,CAAkBiB,CAAlB,EAAqB;AACnB,UAAIzE,CAAC,GAAGhD,EAAE,CAACoH,WAAH,CAAe,KAAKpB,QAApB,EAA8ByB,CAA9B,CAAR;AACA,WAAKzB,QAAL,GAAgBhD,CAAC,CAAC,CAAD,CAAjB;AACA,aAAO,UAASqE,CAAT,EAAY;AACjB,eAAOjF,GAAG,CAACY,CAAC,CAACqE,CAAD,CAAF,CAAV;AACD,OAFD;AAGD;AAEA;;AAGDK,EAAAA,MAAM,GAAG;AACL,WACJ;AAAK,MAAA,EAAE,EAAC,gBAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,EAAE,EAAC,gBAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAM,MAAA,EAAE,EAAC,QAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAI,MAAA,EAAE,EAAC,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAFF,CADF,EAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,KAAK,EAAC,cAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAO,MAAA,EAAE,EAAC,WAAV;AAAsB,MAAA,KAAK,EAAC,aAA5B;AAA0C,MAAA,IAAI,EAAC,OAA/C;AAAuD,MAAA,KAAK,EAAC,GAA7D;AAAiE,MAAA,GAAG,EAAC,GAArE;AAAyE,MAAA,GAAG,EAAC,IAA7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,EAGE;AAAM,MAAA,KAAK,EAAC,aAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHF,CADF,EAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MANF,CAJF,CADF,CADF,EAoBE;AAAO,MAAA,EAAE,EAAC,UAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAI,MAAA,KAAK,EAAC,YAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADF,CAFF,CApBF,CADF,EA6BI;AAAK,MAAA,EAAE,EAAC,UAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA7BJ,EA8BI;AAAK,MAAA,EAAE,EAAC,KAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA9BJ,CADI;AAkCD;;AAveoC;;AAyerC,eAAetH,QAAf","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport './pc.css';\nimport $ from 'jquery';\n//import * as js from './jsondata.json'\n//import * as jsondata from './jsondata'\nvar jsondata=require('/home/andy/rr/consuming-rest/src/jsondata.json');\n\nclass piechart extends React.Component {\nconstructor(props){\n      super(props)\n      //this.createGraph = this.createGraph(this);\n      this.myRef = React.createRef();\n   }\n\n//    static propTypes = {...}\n\n    componentDidMount() {\n       this.d3pieChart()\n    }\n    componentDidUpdate() {\n       //this.createGraph(this.myRef)\n    }\n    componentWillMount() {\n       //this.createGraph(this.myRef)\n    }\n\n\nd3pieChart()\n{\n\nvar nb_sliders = null; // nb of range sliders\nvar moving_id = null; // id of the moved slider\nvar oldValue = []; // previous values of the sliders\n\n// pie chart radius\nvar radius = 100;\n\n// setup the margins so we don't clip the outter labels\nvar margin = {\n  top: 100,\n  right: 100,\n  bottom: 100,\n  left: 175\n};\nvar canvasWidth = radius * 2 + margin.left + margin.right,\n  canvasHeight = radius * 2 + margin.top + margin.bottom;\n\n// color scheme (10, 20, 20b, 20c ...)\n//var color = d3.scale.ordinal()\n//  .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n\n//var color = d3.scale.category10(); \nvar color = d3.scaleOrdinal(d3.schemeCategory10);\n\n// center legend\nvar legendData = [{\n  label: \"Sample\",\n  value: 300\n}, {\n  label: \"Total People\",\n  value: 7200000\n}]\n\nvar pi = Math.PI; // 3.14\n\n// pie chart config\nvar pie = d3.pie()\n  .value(function(d) {\n    return d.value;\n  })\n  //.startAngle(-90 * (pi/180))\n  // .endAngle(90 * (pi/180))\n  .sort(null);\n\n// arc object\nvar arc = d3.arc()\n  .outerRadius(radius)\n  .innerRadius(radius / 3);\n\n// My slider\n\nvar range = $('.input-range'),\n  value = $('.range-value');\nvalue.html(range.attr('value'));\n/*\nvar range = 10\nvar value = 10\nvar i = 0\n*/\nrange.on('input', function() {\n  value.html(this.value);\n     showHelp();\n});\n\n// segement number sliders event\nd3.selectAll('.input-range').on('input', function() {\n  nb_sliders = $(this).val();\n  init();\n  \n});\n\n\n// initialize the sliders, events and pie chart\nfunction init() {\n  oldValue = [];\n  moving_id = null;\n  \n \n  d3.select('#rangebox tbody').html('');\n\n  // append sliders to table\n  var i=0;\n  for (i = 0; i < nb_sliders; i++) {\n    var tr = d3.select('#rangebox tbody').append('tr');\n    tr.append('td')\n      .attr('class', 'edit')\n      .attr('bgcolor', function(d, i){return color(i)})\n      .attr('contenteditable', true)\n      .text('' + (i + 1));\n    \n            \n    tr.append('td')\n      .append('input')\n      .attr('type', 'range')\n      .attr('data-id', i)\n      .attr('class', 'range')\n      .attr('step', 1)\n      .attr('min', 0)\n      .attr('max', 100);\n    tr.append('td')\n      .attr('class', 'range_value');\n  }\n\n  d3.selectAll('#rangebox .range').each(function() {\n    var def = parseInt(100 / nb_sliders);\n    this.value = def;\n    oldValue[d3.select(this).attr('data-id')] = this.value;\n  });\n\n  equalize();\n  showValues();\n  pieChart();\n  seteditboxcolor();\n \n  // content edit event\n  d3.selectAll('.edit').on('input', function() {\n    updateLabels();\n  });\n\n  // slider event\n  d3.selectAll('.range').on('input', function() {\n    this.value = parseInt(this.value);\n    if (this.value < 0) this.value = 0;\n    else if (this.value > 100) this.value = 100;\n\n    var id = d3.select(this).attr('data-id');\n    moving_id = id;\n\n    var old_value = oldValue[moving_id];\n    var new_value = this.value;\n    var delta = (new_value - old_value) / (nb_sliders - 1);\n\n    d3.selectAll('#rangebox .range').each(function() {\n      var r_id = d3.select(this).attr('data-id');\n      var r_val = this.value;\n      if (r_id != moving_id && r_val > delta) {\n        var equalized = parseInt(r_val - delta);\n        this.value = equalized;\n        oldValue[r_id] = this.value;\n      }\n    });\n\n    oldValue[moving_id] = new_value;\n\n    equalize();\n    showValues();\n    updatePieChart();\n     \n  });\n}\n\n// set edit box color to match slice color\nfunction showHelp() {\n  // use jQuery to target h5 edit boxes)\n  $(document).ready(function(){\n    $('h5').css({\"opacity\":\".4\"});\n    $('#pieImage').css({\"display\":\"none\"});});\n}\n\n// set edit box color to match slice color\nfunction seteditboxcolor() {\n  // var slicepaths= d3.selectAll('.slice')\n     var mycolors = [0,1,2,3,4,5,6,7,8,9];\n     var editboxes = d3.selectAll('.edit')\n                       .data(mycolors)\n                       .attr('bgcolor', function(d){ return color(d); }) \n }\n\n\n// get JSON data from sliders\nfunction getData() {\n  var json = [];\n  d3.selectAll('#rangebox .range').each(function() {\n\n    json.push({\n      label: d3.select(this.parentNode.parentNode)\n        .select('td:first-child')\n        .text(),\n      value: this.value\n    });\n  });\n  return json;\n}\n\n// compute total percentage from sliders\nfunction getTotal() {\n  var total = 0;\n  d3.selectAll('#rangebox .range').each(function() {\n    total = total + parseInt(this.value);\n  });\n  return total;\n}\n\n// equalize the sliders (decimal delta)\nfunction equalize() {\n  var remaining = 100 - getTotal();\n\n  if (remaining != 0) {\n    var to_eq = null;\n    var min = null;\n    var max = null;\n    var min_value = 9999;\n    var max_value = 0;\n\n    console.log(remaining);\n\n    d3.selectAll('#rangebox .range').each(function() {\n      var id = d3.select(this).attr('data-id');\n\n      if (id != moving_id) {\n        if (parseInt(this.value) > parseInt(max_value)) {\n          max_value = this.value;\n          max = this;\n        }\n        if (parseInt(this.value) < parseInt(min_value)) {\n          min_value = this.value;\n          min = this;\n        }\n      }\n    });\n\n    if (remaining > 0) to_eq = min;\n    else to_eq = max;\n\n    if (to_eq) {\n      if (remaining > 0) {\n        to_eq.value = parseInt(to_eq.value) + 1;\n        remaining = remaining - 1;\n      } else {\n        to_eq.value = parseInt(to_eq.value) - 1;\n        remaining = remaining + 1;\n      }\n      oldValue[d3.select(to_eq).attr('data-id')] = to_eq.value;\n\n      if (remaining != 0) equalize();\n    }\n  }\n}\n\n// show slider value\nfunction showValues() {\n  d3.selectAll('#rangebox .range').each(function() {\n    var perct = this.value + '%';\n    d3.select(this.parentNode.nextSibling).html(perct);\n  });\n}\n\n// draw pie chart\nfunction pieChart() {\n  \n  \n  var json = getData();\n  var canvaCenterX = (radius * 2 + margin.left + margin.right) / 2;\n  var canvaCenterY = (radius * 2 + margin.top + margin.bottom) / 2;\n\n  d3.select(\"#pie svg\").remove();\n\n  // svg canvas\n  var svg = d3.select(\"#pie\")\n\n  .append(\"svg:svg\")\n    .attr(\"width\", canvasWidth)\n    .attr(\"height\", canvasHeight)\n\n  .append(\"svg:g\")\n    .attr(\"transform\", \"translate(\" + canvasWidth / 2 + \",\" + canvasHeight / 2 + \")\")\n\n  // create the classes under the transform\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"slices\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"labels\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"lines\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"legend\");\n\n  // group all ther paths into the slices class\n  var arcpaths = svg.select(\".slices\").selectAll(\"path\").data(pie(getData()))\n\n  // render the slices\n  arcpaths.enter()\n\n  .append('svg:path')\n    .attr(\"class\", \"slice\")\n    .attr(\"fill\", function(d, i) {\n      return color(i);\n    })\n    \n       \n      .attr(\"d\", arc)\n    .each(function(d) {\n      this._current = d;\n    })\n    .append('title')\n    .text(function(d, i) {\n      return json[i].value + '%';\n    });\n      \n  // group all ther paths into the slices class\n  var arclabels = svg.select(\".labels\").selectAll(\"label\").data(pie(getData()))\n\n  // render the labels\n  arclabels.enter()\n  \n  .append(\"svg:text\")\n    .attr(\"class\", \"label\")\n    .attr(\"transform\", function(d) {\n      return \"translate(\" + arc.centroid(d) + \")\";\n    })\n    .attr(\"text-anchor\", \"middle\")\n    .text(function(d, i) {\n      if (json[i].value > 1) return json[i].label;\n      else return null;\n    });\n }\n\n// update pie chart\nfunction updatePieChart() {\n  updateArcs();\n  updateLabels();\n  updateLabelLines();\n  \n}\n\n// update the slices of the pie chart\nfunction updateArcs() {\n   var json = getData();\n\n  d3.selectAll(\"#pie path title\")\n    .text(function(d, i) {\n      return json[i].value + '%';\n    });\n\n  d3.selectAll(\"#pie path\")\n    .data(pie(json))\n    .transition()\n    .duration(100)\n    .attrTween('d', arcTween);\n}\n\n/* ------- TEXT LABELS -------*/\n// update the labels of the pie chart\nfunction updateLabels() {\n  var labelr = radius + 40 // radius for label anchor\n  d3.selectAll(\"#pie text\")\n    .data(pie(getData()))\n    .transition()\n    .duration(120)\n\n  .attr(\"transform\", function(d) {\n      var c = arc.centroid(d),\n        x = c[0],\n        y = c[1],\n        // pythagorean theorem for hypotenuse\n        h = Math.sqrt(x * x + y * y);\n      return \"translate(\" + (x / h * labelr) + ',' +\n        (y / h * labelr) + \")\";\n    })\n    .attr(\"dy\", \".35em\")\n    .attr(\"text-anchor\", function(d) {\n      // are we past the center?\n      return (d.endAngle + d.startAngle) / 2 > Math.PI ?\n        \"end\" : \"start\";\n    })\n\n  //.text(function(d, i) { return d.value.toFixed(2); });\n  .text(function(d, i) {\n    if (getData()[i].value > 0) return getData()[i].label;\n    else return null;\n  });\n}\n\n/* ------- SLICE TO TEXT POLYLINES -------*/\n\nvar outerArc =d3.arc()\n  .innerRadius(radius +50)\n  .outerRadius(radius * .95);\n\nfunction midAngle(d) {\n  return d.startAngle + (d.endAngle - d.startAngle) / 2;\n}\n\nfunction updateLabelLines() {\n  var polyline = d3.select(\".lines\").selectAll(\"polyline\")\n    .data(pie(getData()));\n\n  //alert(\"I am an alert box!\");\n\n  polyline.enter()\n    .append(\"polyline\")\n\n  polyline.transition()\n    .duration(100)\n    .attrTween(\"points\", function(d) {\n      this._current = this._current || d;\n      var interpolate = d3.interpolate(this._current, d);\n      this._current = interpolate(0);\n      return function(t) {\n        var d2 = interpolate(t);\n        var pos = 0; // outerArc.centroid(d2);\n       // pos[0] = radius * .95 * (midAngle(d2) < Math.PI ? 1 : -1);\n       return [arc.centroid(d2), outerArc.centroid(d2)];\n      };\n    });\n\n  polyline.exit()\n    .remove();\n}\n\n// transition for the arcs\nfunction arcTween(a) {\n  var i = d3.interpolate(this._current, a);\n  this._current = i(0);\n  return function(t) {\n    return arc(i(t));\n  };\n}\n\n}\n\n\nrender() {\n    return (\n<div id=\"main-container\">\n  <div id=\"chart-controls\">\n    <form id=\"nbForm\">\n      <ul id=\"menu\">\n        <li>\n         \n          <h4>Select Number of Chart Segments</h4></li>\n        <li>\n          <div class=\"range-slider\">\n            <input id=\"nbSliders\" class=\"input-range\" type=\"range\" value=\"1\" min=\"1\" max=\"10\">\n            </input>\n            <span class=\"range-value\"></span>\n          </div>\n          <br>\n          </br>\n        </li>\n        \n          \n      </ul>\n\n    </form>\n    <table id=\"rangebox\">\n\n      <tbody>\n        <h5 class=\"HideOnLoad\">Click boxes to edit labels</h5>\n         \n      </tbody>\n    </table>\n    </div>\n    <div id=\"pieImage\"></div>\n    <div id=\"pie\" ></div>\n  </div>\n  )\n  }\n}\n  export default piechart;"]},"metadata":{},"sourceType":"module"}