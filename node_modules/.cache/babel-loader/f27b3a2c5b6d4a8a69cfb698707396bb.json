{"ast":null,"code":"var _jsxFileName = \"/home/andy/rr/consuming-rest/src/piechart.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport './pc.css'; //import * as js from './jsondata.json'\n//import * as jsondata from './jsondata'\n\nvar jsondata = require('/home/andy/rr/consuming-rest/src/jsondata.json');\n\nclass piechart extends React.Component {\n  constructor(props) {\n    super(props); //this.createGraph = this.createGraph(this);\n\n    this.myRef = React.createRef();\n  } //    static propTypes = {...}\n\n\n  componentDidMount() {\n    this.piechart();\n  }\n\n  componentDidUpdate() {//this.createGraph(this.myRef)\n  }\n\n  componentWillMount() {//this.createGraph(this.myRef)\n  }\n\n  pieChart() {\n    var nb_sliders = null; // nb of range sliders\n\n    var moving_id = null; // id of the moved slider\n\n    var oldValue = []; // previous values of the sliders\n    // pie chart radius\n\n    var radius = 200; // setup the margins so we don't clip the outter labels\n\n    var margin = {\n      top: 100,\n      right: 100,\n      bottom: 100,\n      left: 175\n    };\n    var canvasWidth = radius * 2 + margin.left + margin.right,\n        canvasHeight = radius * 2 + margin.top + margin.bottom; // color scheme (10, 20, 20b, 20c ...)\n    //var color = d3.scale.ordinal()\n    //  .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n    //var color = d3.scale.category10(); \n\n    var color = d3.scale.category10(); // center legend\n\n    var legendData = [{\n      label: \"Sample\",\n      value: 300\n    }, {\n      label: \"Total People\",\n      value: 7200000\n    }];\n    var pi = Math.PI; // 3.14\n    // pie chart config\n\n    var pie = d3.pie().value(function (d) {\n      return d.value;\n    }) //.startAngle(-90 * (pi/180))\n    // .endAngle(90 * (pi/180))\n    .sort(null); // arc object\n\n    var arc = d3.svg.arc().outerRadius(radius).innerRadius(radius / 3); // My slider\n\n    var range = $('.input-range'),\n        value = $('.range-value');\n    value.html(range.attr('value'));\n    range.on('input', function () {\n      value.html(this.value);\n      showHelp();\n    }); // segement number sliders event\n\n    d3.selectAll('.input-range').on('input', function () {\n      nb_sliders = $(this).val();\n      init();\n    }); // initialize the sliders, events and pie chart\n\n    function init() {\n      oldValue = [];\n      moving_id = null;\n      d3.select('#rangebox tbody').html(''); // append sliders to table\n\n      for (i = 0; i < nb_sliders; i++) {\n        var tr = d3.select('#rangebox tbody').append('tr');\n        tr.append('td').attr('class', 'edit').attr('bgcolor', function (d, i) {\n          return color(i);\n        }).attr('contenteditable', true).text('' + (i + 1));\n        tr.append('td').append('input').attr('type', 'range').attr('data-id', i).attr('class', 'range').attr('step', 1).attr('min', 0).attr('max', 100);\n        tr.append('td').attr('class', 'range_value');\n      }\n\n      d3.selectAll('#rangebox .range').each(function () {\n        var def = parseInt(100 / nb_sliders);\n        this.value = def;\n        oldValue[d3.select(this).attr('data-id')] = this.value;\n      });\n      equalize();\n      showValues();\n      pieChart();\n      seteditboxcolor(); // content edit event\n\n      d3.selectAll('.edit').on('input', function () {\n        updateLabels();\n      }); // slider event\n\n      d3.selectAll('.range').on('input', function () {\n        this.value = parseInt(this.value);\n        if (this.value < 0) this.value = 0;else if (this.value > 100) this.value = 100;\n        var id = d3.select(this).attr('data-id');\n        moving_id = id;\n        var old_value = oldValue[moving_id];\n        var new_value = this.value;\n        var delta = (new_value - old_value) / (nb_sliders - 1);\n        d3.selectAll('#rangebox .range').each(function () {\n          var r_id = d3.select(this).attr('data-id');\n          var r_val = this.value;\n\n          if (r_id != moving_id && r_val > delta) {\n            var equalized = parseInt(r_val - delta);\n            this.value = equalized;\n            oldValue[r_id] = this.value;\n          }\n        });\n        oldValue[moving_id] = new_value;\n        equalize();\n        showValues();\n        updatePieChart();\n      });\n    } // set edit box color to match slice color\n\n\n    function showHelp() {\n      // use jQuery to target h5 edit boxes)\n      $(document).ready(function () {\n        $('h5').css({\n          \"opacity\": \".4\"\n        });\n        $('#pieImage').css({\n          \"display\": \"none\"\n        });\n      });\n    } // set edit box color to match slice color\n\n\n    function seteditboxcolor() {\n      // var slicepaths= d3.selectAll('.slice')\n      var mycolors = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n      var editboxes = d3.selectAll('.edit').data(mycolors).attr('bgcolor', function (d) {\n        return color(d);\n      });\n    } // get JSON data from sliders\n\n\n    function getData() {\n      var json = [];\n      d3.selectAll('#rangebox .range').each(function () {\n        json.push({\n          label: d3.select(this.parentNode.parentNode).select('td:first-child').text(),\n          value: this.value\n        });\n      });\n      return json;\n    } // compute total percentage from sliders\n\n\n    function getTotal() {\n      var total = 0;\n      d3.selectAll('#rangebox .range').each(function () {\n        total = total + parseInt(this.value);\n      });\n      return total;\n    } // equalize the sliders (decimal delta)\n\n\n    function equalize() {\n      var remaining = 100 - getTotal();\n\n      if (remaining != 0) {\n        var to_eq = null;\n        var min = null;\n        var max = null;\n        var min_value = 9999;\n        var max_value = 0;\n        console.log(remaining);\n        d3.selectAll('#rangebox .range').each(function () {\n          var id = d3.select(this).attr('data-id');\n\n          if (id != moving_id) {\n            if (parseInt(this.value) > parseInt(max_value)) {\n              max_value = this.value;\n              max = this;\n            }\n\n            if (parseInt(this.value) < parseInt(min_value)) {\n              min_value = this.value;\n              min = this;\n            }\n          }\n        });\n        if (remaining > 0) to_eq = min;else to_eq = max;\n\n        if (to_eq) {\n          if (remaining > 0) {\n            to_eq.value = parseInt(to_eq.value) + 1;\n            remaining = remaining - 1;\n          } else {\n            to_eq.value = parseInt(to_eq.value) - 1;\n            remaining = remaining + 1;\n          }\n\n          oldValue[d3.select(to_eq).attr('data-id')] = to_eq.value;\n          if (remaining != 0) equalize();\n        }\n      }\n    } // show slider value\n\n\n    function showValues() {\n      d3.selectAll('#rangebox .range').each(function () {\n        var perct = this.value + '%';\n        d3.select(this.parentNode.nextSibling).html(perct);\n      });\n    } // draw pie chart\n\n\n    function pieChart() {\n      var json = getData();\n      var canvaCenterX = (radius * 2 + margin.left + margin.right) / 2;\n      var canvaCenterY = (radius * 2 + margin.top + margin.bottom) / 2;\n      d3.select(\"#pie svg\").remove(); // svg canvas\n\n      var svg = d3.select(\"#pie\").append(\"svg:svg\").attr(\"width\", canvasWidth).attr(\"height\", canvasHeight).append(\"svg:g\").attr(\"transform\", \"translate(\" + canvasWidth / 2 + \",\" + canvasHeight / 2 + \")\"); // create the classes under the transform\n\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"slices\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"labels\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"lines\");\n      d3.select(\"g\").append(\"g\").attr(\"class\", \"legend\"); // group all ther paths into the slices class\n\n      var arcpaths = svg.select(\".slices\").selectAll(\"path\").data(pie(getData())); // render the slices\n\n      arcpaths.enter().append('svg:path').attr(\"class\", \"slice\").attr(\"fill\", function (d, i) {\n        return color(i);\n      }).attr(\"d\", arc).each(function (d) {\n        this._current = d;\n      }).append('title').text(function (d, i) {\n        return json[i].value + '%';\n      }); // group all ther paths into the slices class\n\n      var arclabels = svg.select(\".labels\").selectAll(\"label\").data(pie(getData())); // render the labels\n\n      arclabels.enter().append(\"svg:text\").attr(\"class\", \"label\").attr(\"transform\", function (d) {\n        return \"translate(\" + arc.centroid(d) + \")\";\n      }).attr(\"text-anchor\", \"middle\").text(function (d, i) {\n        if (json[i].value > 1) return json[i].label;else return null;\n      });\n    } // update pie chart\n\n\n    function updatePieChart() {\n      updateArcs();\n      updateLabels();\n      updateLabelLines();\n    } // update the slices of the pie chart\n\n\n    function updateArcs() {\n      var json = getData();\n      d3.selectAll(\"#pie path title\").text(function (d, i) {\n        return json[i].value + '%';\n      });\n      d3.selectAll(\"#pie path\").data(pie(json)).transition().duration(100).attrTween('d', arcTween);\n    }\n    /* ------- TEXT LABELS -------*/\n    // update the labels of the pie chart\n\n\n    function updateLabels() {\n      labelr = radius + 40; // radius for label anchor\n\n      d3.selectAll(\"#pie text\").data(pie(getData())).transition().duration(120).attr(\"transform\", function (d) {\n        var c = arc.centroid(d),\n            x = c[0],\n            y = c[1],\n            // pythagorean theorem for hypotenuse\n        h = Math.sqrt(x * x + y * y);\n        return \"translate(\" + x / h * labelr + ',' + y / h * labelr + \")\";\n      }).attr(\"dy\", \".35em\").attr(\"text-anchor\", function (d) {\n        // are we past the center?\n        return (d.endAngle + d.startAngle) / 2 > Math.PI ? \"end\" : \"start\";\n      }) //.text(function(d, i) { return d.value.toFixed(2); });\n      .text(function (d, i) {\n        if (getData()[i].value > 0) return getData()[i].label;else return null;\n      });\n    }\n    /* ------- SLICE TO TEXT POLYLINES -------*/\n\n\n    var outerArc = d3.svg.arc().innerRadius(radius + 50).outerRadius(radius * .95);\n\n    function midAngle(d) {\n      return d.startAngle + (d.endAngle - d.startAngle) / 2;\n    }\n\n    function updateLabelLines() {\n      var polyline = d3.select(\".lines\").selectAll(\"polyline\").data(pie(getData())); //alert(\"I am an alert box!\");\n\n      polyline.enter().append(\"polyline\");\n      polyline.transition().duration(100).attrTween(\"points\", function (d) {\n        this._current = this._current || d;\n        var interpolate = d3.interpolate(this._current, d);\n        this._current = interpolate(0);\n        return function (t) {\n          var d2 = interpolate(t);\n          var pos = 0; // outerArc.centroid(d2);\n          // pos[0] = radius * .95 * (midAngle(d2) < Math.PI ? 1 : -1);\n\n          return [arc.centroid(d2), outerArc.centroid(d2)];\n        };\n      });\n      polyline.exit().remove();\n    } // transition for the arcs\n\n\n    function arcTween(a) {\n      var i = d3.interpolate(this._current, a);\n      this._current = i(0);\n      return function (t) {\n        return arc(i(t));\n      };\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"main-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 456\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"chart-controls\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 457\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      id: \"nbForm\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 458\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      id: \"menu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 459\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 460\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462\n      },\n      __self: this\n    }, \"Select Number of Chart Segments\")), React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      class: \"range-slider\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      id: \"nbSliders\",\n      class: \"input-range\",\n      type: \"range\",\n      value: \"1\",\n      min: \"1\",\n      max: \"10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 465\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      class: \"range-value\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467\n      },\n      __self: this\n    })), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469\n      },\n      __self: this\n    })))), React.createElement(\"table\", {\n      id: \"rangebox\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477\n      },\n      __self: this\n    }, React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      class: \"HideOnLoad\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 480\n      },\n      __self: this\n    }, \"Click boxes to edit labels\")))), React.createElement(\"div\", {\n      id: \"pieImage\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"pie\",\n      display: hidden,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default piechart;","map":{"version":3,"sources":["/home/andy/rr/consuming-rest/src/piechart.js"],"names":["React","Component","d3","jsondata","require","piechart","constructor","props","myRef","createRef","componentDidMount","componentDidUpdate","componentWillMount","pieChart","nb_sliders","moving_id","oldValue","radius","margin","top","right","bottom","left","canvasWidth","canvasHeight","color","scale","category10","legendData","label","value","pi","Math","PI","pie","d","sort","arc","svg","outerRadius","innerRadius","range","$","html","attr","on","showHelp","selectAll","val","init","select","i","tr","append","text","each","def","parseInt","equalize","showValues","seteditboxcolor","updateLabels","id","old_value","new_value","delta","r_id","r_val","equalized","updatePieChart","document","ready","css","mycolors","editboxes","data","getData","json","push","parentNode","getTotal","total","remaining","to_eq","min","max","min_value","max_value","console","log","perct","nextSibling","canvaCenterX","canvaCenterY","remove","arcpaths","enter","_current","arclabels","centroid","updateArcs","updateLabelLines","transition","duration","attrTween","arcTween","labelr","c","x","y","h","sqrt","endAngle","startAngle","outerArc","midAngle","polyline","interpolate","t","d2","pos","exit","a","render","hidden"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport './pc.css'\n//import * as js from './jsondata.json'\n//import * as jsondata from './jsondata'\nvar jsondata=require('/home/andy/rr/consuming-rest/src/jsondata.json');\n\nclass piechart extends React.Component {\nconstructor(props){\n      super(props)\n      //this.createGraph = this.createGraph(this);\n      this.myRef = React.createRef();\n   }\n\n//    static propTypes = {...}\n\n    componentDidMount() {\n       this.piechart()\n    }\n    componentDidUpdate() {\n       //this.createGraph(this.myRef)\n    }\n    componentWillMount() {\n       //this.createGraph(this.myRef)\n    }\n\n\npieChart()\n{\n\nvar nb_sliders = null; // nb of range sliders\nvar moving_id = null; // id of the moved slider\nvar oldValue = []; // previous values of the sliders\n\n// pie chart radius\nvar radius = 200;\n\n// setup the margins so we don't clip the outter labels\nvar margin = {\n  top: 100,\n  right: 100,\n  bottom: 100,\n  left: 175\n};\nvar canvasWidth = radius * 2 + margin.left + margin.right,\n  canvasHeight = radius * 2 + margin.top + margin.bottom;\n\n// color scheme (10, 20, 20b, 20c ...)\n//var color = d3.scale.ordinal()\n//  .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n\n//var color = d3.scale.category10(); \nvar color = d3.scale.category10();\n\n// center legend\nvar legendData = [{\n  label: \"Sample\",\n  value: 300\n}, {\n  label: \"Total People\",\n  value: 7200000\n}]\n\nvar pi = Math.PI; // 3.14\n\n// pie chart config\nvar pie = d3.pie()\n  .value(function(d) {\n    return d.value;\n  })\n  //.startAngle(-90 * (pi/180))\n  // .endAngle(90 * (pi/180))\n  .sort(null);\n\n// arc object\nvar arc = d3.svg.arc()\n  .outerRadius(radius)\n  .innerRadius(radius / 3);\n\n// My slider\nvar range = $('.input-range'),\n  value = $('.range-value');\nvalue.html(range.attr('value'));\n\nrange.on('input', function() {\n  value.html(this.value);\n     showHelp();\n});\n\n// segement number sliders event\nd3.selectAll('.input-range').on('input', function() {\n  nb_sliders = $(this).val();\n  init();\n  \n});\n\n\n// initialize the sliders, events and pie chart\nfunction init() {\n  oldValue = [];\n  moving_id = null;\n  \n \n  d3.select('#rangebox tbody').html('');\n\n  // append sliders to table\n  for (i = 0; i < nb_sliders; i++) {\n    var tr = d3.select('#rangebox tbody').append('tr');\n    tr.append('td')\n      .attr('class', 'edit')\n      .attr('bgcolor', function(d, i){return color(i)})\n      .attr('contenteditable', true)\n      .text('' + (i + 1));\n    \n            \n    tr.append('td')\n      .append('input')\n      .attr('type', 'range')\n      .attr('data-id', i)\n      .attr('class', 'range')\n      .attr('step', 1)\n      .attr('min', 0)\n      .attr('max', 100);\n    tr.append('td')\n      .attr('class', 'range_value');\n  }\n\n  d3.selectAll('#rangebox .range').each(function() {\n    var def = parseInt(100 / nb_sliders);\n    this.value = def;\n    oldValue[d3.select(this).attr('data-id')] = this.value;\n  });\n\n  equalize();\n  showValues();\n  pieChart();\n  seteditboxcolor();\n \n  // content edit event\n  d3.selectAll('.edit').on('input', function() {\n    updateLabels();\n  });\n\n  // slider event\n  d3.selectAll('.range').on('input', function() {\n    this.value = parseInt(this.value);\n    if (this.value < 0) this.value = 0;\n    else if (this.value > 100) this.value = 100;\n\n    var id = d3.select(this).attr('data-id');\n    moving_id = id;\n\n    var old_value = oldValue[moving_id];\n    var new_value = this.value;\n    var delta = (new_value - old_value) / (nb_sliders - 1);\n\n    d3.selectAll('#rangebox .range').each(function() {\n      var r_id = d3.select(this).attr('data-id');\n      var r_val = this.value;\n      if (r_id != moving_id && r_val > delta) {\n        var equalized = parseInt(r_val - delta);\n        this.value = equalized;\n        oldValue[r_id] = this.value;\n      }\n    });\n\n    oldValue[moving_id] = new_value;\n\n    equalize();\n    showValues();\n    updatePieChart();\n     \n  });\n}\n\n// set edit box color to match slice color\nfunction showHelp() {\n  // use jQuery to target h5 edit boxes)\n  $(document).ready(function(){\n    $('h5').css({\"opacity\":\".4\"});\n    $('#pieImage').css({\"display\":\"none\"});});\n}\n\n// set edit box color to match slice color\nfunction seteditboxcolor() {\n  // var slicepaths= d3.selectAll('.slice')\n     var mycolors = [0,1,2,3,4,5,6,7,8,9];\n     var editboxes = d3.selectAll('.edit')\n                       .data(mycolors)\n                       .attr('bgcolor', function(d){ return color(d); }) \n }\n\n\n// get JSON data from sliders\nfunction getData() {\n  var json = [];\n  d3.selectAll('#rangebox .range').each(function() {\n\n    json.push({\n      label: d3.select(this.parentNode.parentNode)\n        .select('td:first-child')\n        .text(),\n      value: this.value\n    });\n  });\n  return json;\n}\n\n// compute total percentage from sliders\nfunction getTotal() {\n  var total = 0;\n  d3.selectAll('#rangebox .range').each(function() {\n    total = total + parseInt(this.value);\n  });\n  return total;\n}\n\n// equalize the sliders (decimal delta)\nfunction equalize() {\n  var remaining = 100 - getTotal();\n\n  if (remaining != 0) {\n    var to_eq = null;\n    var min = null;\n    var max = null;\n    var min_value = 9999;\n    var max_value = 0;\n\n    console.log(remaining);\n\n    d3.selectAll('#rangebox .range').each(function() {\n      var id = d3.select(this).attr('data-id');\n\n      if (id != moving_id) {\n        if (parseInt(this.value) > parseInt(max_value)) {\n          max_value = this.value;\n          max = this;\n        }\n        if (parseInt(this.value) < parseInt(min_value)) {\n          min_value = this.value;\n          min = this;\n        }\n      }\n    });\n\n    if (remaining > 0) to_eq = min;\n    else to_eq = max;\n\n    if (to_eq) {\n      if (remaining > 0) {\n        to_eq.value = parseInt(to_eq.value) + 1;\n        remaining = remaining - 1;\n      } else {\n        to_eq.value = parseInt(to_eq.value) - 1;\n        remaining = remaining + 1;\n      }\n      oldValue[d3.select(to_eq).attr('data-id')] = to_eq.value;\n\n      if (remaining != 0) equalize();\n    }\n  }\n}\n\n// show slider value\nfunction showValues() {\n  d3.selectAll('#rangebox .range').each(function() {\n    var perct = this.value + '%';\n    d3.select(this.parentNode.nextSibling).html(perct);\n  });\n}\n\n// draw pie chart\nfunction pieChart() {\n  \n  \n  var json = getData();\n  var canvaCenterX = (radius * 2 + margin.left + margin.right) / 2;\n  var canvaCenterY = (radius * 2 + margin.top + margin.bottom) / 2;\n\n  d3.select(\"#pie svg\").remove();\n\n  // svg canvas\n  var svg = d3.select(\"#pie\")\n\n  .append(\"svg:svg\")\n    .attr(\"width\", canvasWidth)\n    .attr(\"height\", canvasHeight)\n\n  .append(\"svg:g\")\n    .attr(\"transform\", \"translate(\" + canvasWidth / 2 + \",\" + canvasHeight / 2 + \")\")\n\n  // create the classes under the transform\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"slices\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"labels\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"lines\");\n\n  d3.select(\"g\")\n    .append(\"g\")\n    .attr(\"class\", \"legend\");\n\n  // group all ther paths into the slices class\n  var arcpaths = svg.select(\".slices\").selectAll(\"path\").data(pie(getData()))\n\n  // render the slices\n  arcpaths.enter()\n\n  .append('svg:path')\n    .attr(\"class\", \"slice\")\n    .attr(\"fill\", function(d, i) {\n      return color(i);\n    })\n    \n       \n      .attr(\"d\", arc)\n    .each(function(d) {\n      this._current = d;\n    })\n    .append('title')\n    .text(function(d, i) {\n      return json[i].value + '%';\n    });\n      \n  // group all ther paths into the slices class\n  var arclabels = svg.select(\".labels\").selectAll(\"label\").data(pie(getData()))\n\n  // render the labels\n  arclabels.enter()\n  \n  .append(\"svg:text\")\n    .attr(\"class\", \"label\")\n    .attr(\"transform\", function(d) {\n      return \"translate(\" + arc.centroid(d) + \")\";\n    })\n    .attr(\"text-anchor\", \"middle\")\n    .text(function(d, i) {\n      if (json[i].value > 1) return json[i].label;\n      else return null;\n    });\n }\n\n// update pie chart\nfunction updatePieChart() {\n  updateArcs();\n  updateLabels();\n  updateLabelLines();\n  \n}\n\n// update the slices of the pie chart\nfunction updateArcs() {\n   var json = getData();\n\n  d3.selectAll(\"#pie path title\")\n    .text(function(d, i) {\n      return json[i].value + '%';\n    });\n\n  d3.selectAll(\"#pie path\")\n    .data(pie(json))\n    .transition()\n    .duration(100)\n    .attrTween('d', arcTween);\n}\n\n/* ------- TEXT LABELS -------*/\n// update the labels of the pie chart\nfunction updateLabels() {\n  labelr = radius + 40 // radius for label anchor\n  d3.selectAll(\"#pie text\")\n    .data(pie(getData()))\n    .transition()\n    .duration(120)\n\n  .attr(\"transform\", function(d) {\n      var c = arc.centroid(d),\n        x = c[0],\n        y = c[1],\n        // pythagorean theorem for hypotenuse\n        h = Math.sqrt(x * x + y * y);\n      return \"translate(\" + (x / h * labelr) + ',' +\n        (y / h * labelr) + \")\";\n    })\n    .attr(\"dy\", \".35em\")\n    .attr(\"text-anchor\", function(d) {\n      // are we past the center?\n      return (d.endAngle + d.startAngle) / 2 > Math.PI ?\n        \"end\" : \"start\";\n    })\n\n  //.text(function(d, i) { return d.value.toFixed(2); });\n  .text(function(d, i) {\n    if (getData()[i].value > 0) return getData()[i].label;\n    else return null;\n  });\n}\n\n/* ------- SLICE TO TEXT POLYLINES -------*/\n\nvar outerArc = d3.svg.arc()\n  .innerRadius(radius +50)\n  .outerRadius(radius * .95);\n\nfunction midAngle(d) {\n  return d.startAngle + (d.endAngle - d.startAngle) / 2;\n}\n\nfunction updateLabelLines() {\n  var polyline = d3.select(\".lines\").selectAll(\"polyline\")\n    .data(pie(getData()));\n\n  //alert(\"I am an alert box!\");\n\n  polyline.enter()\n    .append(\"polyline\")\n\n  polyline.transition()\n    .duration(100)\n    .attrTween(\"points\", function(d) {\n      this._current = this._current || d;\n      var interpolate = d3.interpolate(this._current, d);\n      this._current = interpolate(0);\n      return function(t) {\n        var d2 = interpolate(t);\n        var pos = 0; // outerArc.centroid(d2);\n       // pos[0] = radius * .95 * (midAngle(d2) < Math.PI ? 1 : -1);\n       return [arc.centroid(d2), outerArc.centroid(d2)];\n      };\n    });\n\n  polyline.exit()\n    .remove();\n}\n\n// transition for the arcs\nfunction arcTween(a) {\n  var i = d3.interpolate(this._current, a);\n  this._current = i(0);\n  return function(t) {\n    return arc(i(t));\n  };\n}\n\n}\n\n\nrender() {\n    return (\n<div id=\"main-container\">\n  <div id=\"chart-controls\">\n    <form id=\"nbForm\">\n      <ul id=\"menu\">\n        <li>\n         \n          <h4>Select Number of Chart Segments</h4></li>\n        <li>\n          <div class=\"range-slider\">\n            <input id=\"nbSliders\" class=\"input-range\" type=\"range\" value=\"1\" min=\"1\" max=\"10\">\n            </input>\n            <span class=\"range-value\"></span>\n          </div>\n          <br>\n          </br>\n        </li>\n        \n          \n      </ul>\n\n    </form>\n    <table id=\"rangebox\">\n\n      <tbody>\n        <h5 class=\"HideOnLoad\">Click boxes to edit labels</h5>\n         \n      </tbody>\n    </table>\n    </div>\n    <div id=\"pieImage\"></div>\n    <div id=\"pie\" display={hidden}></div>\n  </div>\n  )\n  }\n}\n  export default piechart;"]},"metadata":{},"sourceType":"module"}